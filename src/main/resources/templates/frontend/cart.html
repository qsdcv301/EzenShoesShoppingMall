<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>신발 쇼핑몰</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* 전체페이지 스타일 */
        body {
            font-family: Arial, sans-serif;
        }

        /* header & footer */
        .header,
        .footer {
            text-align: center;
            padding: 20px;
            background-color: #f8f9fa;
        }

        /* 상품 섹션 */
        .product-card {
            border: 1px solid #ddd;
            margin-bottom: 15px;
        }

        .product-card img {
            width: 100px;
            height: auto;
        }
        /* 가격 정보 섹션 */
        .total-price {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
        }
        /* 버튼 */
        .btn-primary {
            background-color: #007bff;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>헤더가 들어갈부분</h1>
    </div>

    <div class="container my-4">
        <div class="row">
            <!-- 주문상품목록섹션 -->
            <div class="col-md-8">
                <!-- 상품선택 및 삭제 -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>주문 상품 요약</h2>
                    <div>
                        <button id="select-all" class="btn btn-primary mr-2">전체 선택</button>
                        <button id="deselect-all" class="btn btn-secondary mr-2" style="display: none;">전체 선택 해제</button>
                        <button id="delete-selected" class="btn btn-danger">선택 삭제</button>
                    </div>
                </div>
                <!-- 상품목록 -->
                <div id="product-list">

                    <!-- 상품 추가 루프 -->
                    <div class="product-card card" data-price="89000">
                        <div class="card-body d-flex align-items-center">
                            <input type="checkbox" class="mr-3 product-checkbox">
                            <img th:src="${imageUrls.get(index.index)}"
                            th:alt="${product.name}" class="img-thumbnail mr-3">
                            <div>
                                <h5 class="card-title" th:text="${product.name}"><a href="나이키 브랜드 페이지로 이동"><strong
                                            class="text-dark">나이키</strong></a> 에어맥스</h5>
                                <p class="card-text product-info" th:text="${product.description}">사이즈 : 250 / 수량 : 1개</p>
                                <p class="card-text">가격: <span class="product-price" th:text="${product.price}">89,000 EZ코인</span></p>
                                <button class="btn btn-sm btn-dark edit-btn">옵션 변경</button>
                                <div class="edit-form" style="display: none;">
                                    <div class="form-group">
                                        <label for="size-1">사이즈:</label>
                                        <select id="size-1" class="form-control size-select">
                                            <option value="240">240</option>
                                            <option value="250" selected>250</option>
                                            <option value="260">260</option>
                                            <option value="270">270</option>
                                            <option value="280">280</option>
                                            <option value="290">290</option>
                                            <option value="300">300</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="quantity-1">수량:</label>
                                        <input type="number" id="quantity-1" class="form-control quantity-input"
                                            value="1" min="1">
                                    </div>
                                    <button class="btn btn-sm btn-primary save-btn">저장</button>
                                    <button class="btn btn-sm btn-secondary cancel-btn">취소</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /상품 추가 루프 -->

                    <!-- <div class="product-card card" data-price="89000">
                        <div class="card-body d-flex align-items-center">
                            <input type="checkbox" class="mr-3 product-checkbox">
                            <img src="images/airmax.png" alt="상품 이미지" class="img-thumbnail mr-3">
                            <div>
                                <h5 class="card-title"><a href="나이키 브랜드 페이지로 이동"><strong
                                            class="text-dark">나이키</strong></a> 에어맥스</h5>
                                <p class="card-text product-info">사이즈 : 250 / 수량 : 1개</p>
                                <p class="card-text">가격: <span class="product-price">89,000 EZ코인</span></p>
                                <button class="btn btn-sm btn-dark edit-btn">옵션 변경</button>
                                <div class="edit-form" style="display: none;">
                                    <div class="form-group">
                                        <label for="size-1">사이즈:</label>
                                        <select id="size-1" class="form-control size-select">
                                            <option value="240">240</option>
                                            <option value="250" selected>250</option>
                                            <option value="260">260</option>
                                            <option value="270">270</option>
                                            <option value="280">280</option>
                                            <option value="290">290</option>
                                            <option value="300">300</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="quantity-1">수량:</label>
                                        <input type="number" id="quantity-1" class="form-control quantity-input"
                                            value="1" min="1">
                                    </div>
                                    <button class="btn btn-sm btn-primary save-btn">저장</button>
                                    <button class="btn btn-sm btn-secondary cancel-btn">취소</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="product-card card" data-price="89000">
                        <div class="card-body d-flex align-items-center">
                            <input type="checkbox" class="mr-3 product-checkbox">
                            <img src="images/airmax.png" alt="상품 이미지" class="img-thumbnail mr-3">
                            <div>
                                <h5 class="card-title"><a href="나이키 브랜드 페이지로 이동"><strong
                                            class="text-dark">나이키</strong></a> 에어맥스</h5>
                                <p class="card-text product-info">사이즈 : 250 / 수량 : 1개</p>
                                <p class="card-text">가격: <span class="product-price">89,000 EZ코인</span></p>
                                <button class="btn btn-sm btn-dark edit-btn">옵션 변경</button>
                                <div class="edit-form" style="display: none;">
                                    <div class="form-group">
                                        <label for="size-1">사이즈:</label>
                                        <select id="size-1" class="form-control size-select">
                                            <option value="240">240</option>
                                            <option value="250" selected>250</option>
                                            <option value="260">260</option>
                                            <option value="270">270</option>
                                            <option value="280">280</option>
                                            <option value="290">290</option>
                                            <option value="300">300</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="quantity-1">수량:</label>
                                        <input type="number" id="quantity-1" class="form-control quantity-input"
                                            value="1" min="1">
                                    </div>
                                    <button class="btn btn-sm btn-primary save-btn">저장</button>
                                    <button class="btn btn-sm btn-secondary cancel-btn">취소</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="product-card card" data-price="89000">
                        <div class="card-body d-flex align-items-center">
                            <input type="checkbox" class="mr-3 product-checkbox">
                            <img src="images/airmax.png" alt="상품 이미지" class="img-thumbnail mr-3">
                            <div>
                                <h5 class="card-title"><a href="나이키 브랜드 페이지로 이동"><strong
                                            class="text-dark">나이키</strong></a> 에어맥스</h5>
                                <p class="card-text product-info">사이즈 : 250 / 수량 : 1개</p>
                                <p class="card-text">가격: <span class="product-price">89,000 EZ코인</span></p>
                                <button class="btn btn-sm btn-dark edit-btn">옵션 변경</button>
                                <div class="edit-form" style="display: none;">
                                    <div class="form-group">
                                        <label for="size-1">사이즈:</label>
                                        <select id="size-1" class="form-control size-select">
                                            <option value="240">240</option>
                                            <option value="250" selected>250</option>
                                            <option value="260">260</option>
                                            <option value="270">270</option>
                                            <option value="280">280</option>
                                            <option value="290">290</option>
                                            <option value="300">300</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="quantity-1">수량:</label>
                                        <input type="number" id="quantity-1" class="form-control quantity-input"
                                            value="1" min="1">
                                    </div>
                                    <button class="btn btn-sm btn-primary save-btn">저장</button>
                                    <button class="btn btn-sm btn-secondary cancel-btn">취소</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="product-card card" data-price="89000">
                        <div class="card-body d-flex align-items-center">
                            <input type="checkbox" class="mr-3 product-checkbox">
                            <img src="images/airmax.png" alt="상품 이미지" class="img-thumbnail mr-3">
                            <div>
                                <h5 class="card-title"><a href="나이키 브랜드 페이지로 이동"><strong
                                            class="text-dark">나이키</strong></a> 에어맥스</h5>
                                <p class="card-text product-info">사이즈 : 250 / 수량 : 1개</p>
                                <p class="card-text">가격: <span class="product-price">89,000 EZ코인</span></p>
                                <button class="btn btn-sm btn-dark edit-btn">옵션 변경</button>
                                <div class="edit-form" style="display: none;">
                                    <div class="form-group">
                                        <label for="size-1">사이즈:</label>
                                        <select id="size-1" class="form-control size-select">
                                            <option value="240">240</option>
                                            <option value="250" selected>250</option>
                                            <option value="260">260</option>
                                            <option value="270">270</option>
                                            <option value="280">280</option>
                                            <option value="290">290</option>
                                            <option value="300">300</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="quantity-1">수량:</label>
                                        <input type="number" id="quantity-1" class="form-control quantity-input"
                                            value="1" min="1">
                                    </div>
                                    <button class="btn btn-sm btn-primary save-btn">저장</button>
                                    <button class="btn btn-sm btn-secondary cancel-btn">취소</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="product-card card" data-price="89000">
                        <div class="card-body d-flex align-items-center">
                            <input type="checkbox" class="mr-3 product-checkbox">
                            <img src="images/airmax.png" alt="상품 이미지" class="img-thumbnail mr-3">
                            <div>
                                <h5 class="card-title"><a href="나이키 브랜드 페이지로 이동"><strong
                                            class="text-dark">나이키</strong></a> 에어맥스</h5>
                                <p class="card-text product-info">사이즈 : 250 / 수량 : 1개</p>
                                <p class="card-text">가격: <span class="product-price">89,000 EZ코인</span></p>
                                <button class="btn btn-sm btn-dark edit-btn">옵션 변경</button>
                                <div class="edit-form" style="display: none;">
                                    <div class="form-group">
                                        <label for="size-1">사이즈:</label>
                                        <select id="size-1" class="form-control size-select">
                                            <option value="240">240</option>
                                            <option value="250" selected>250</option>
                                            <option value="260">260</option>
                                            <option value="270">270</option>
                                            <option value="280">280</option>
                                            <option value="290">290</option>
                                            <option value="300">300</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="quantity-1">수량:</label>
                                        <input type="number" id="quantity-1" class="form-control quantity-input"
                                            value="1" min="1">
                                    </div>
                                    <button class="btn btn-sm btn-primary save-btn">저장</button>
                                    <button class="btn btn-sm btn-secondary cancel-btn">취소</button>
                                </div>
                            </div>
                        </div>
                    </div> -->

                </div>
            </div>
            <!-- 가격 정보 섹션 -->
            <div class="col-md-4 total-price">
                <h2>Total Price</h2>
                <!-- 주문 요약 정보 -->
                <p>주문 상품 수: <span id="item-count">0</span></p>
                <p>상품 총액: <span id="total-amount">0 EZ코인</span></p>
                <p>할인 금액: <span id="discount">0 EZ코인</span></p>
                <p>배송비: <span id="shipping-cost">3,000 EZ코인</span></p>
                <small class="text-muted">50,000 EZ코인 이상 배송비 무료</small>
                <hr>
                <p><strong>전체 주문 금액: </strong><span id="final-amount">0 EZ코인</span></p>
                <button class="btn btn-primary btn-block">구매하기</button>
            </div>
        </div>
    </div>

    <div class="footer">
        푸터
    </div>

    <!-- 결제 모달 -->
    <div class="modal fade" id="paymentModal" tabindex="-1" role="dialog" aria-labelledby="paymentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentModalLabel">결제 정보</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-7">
                                    <h5 class="card-title mb-3">선택한 상품</h5>
                                    <div id="selected-products" class="row"></div>
                                </div>
                                <div class="col-md-5">
                                    <h5 class="card-title mb-3">결제 정보</h5>
                                    <div id="payment-summary"></div>
                                    <div id="insufficient-funds" class="text-danger mt-3" style="display: none;">
                                        보유 코인이 부족합니다.
                                        <button id="recharge-button" class="btn btn-warning btn-sm ml-2">충전하기</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-primary" id="confirm-payment">결제 하기</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        $(document).ready(function () {
            const userBalance = 200000; // 사용자의 ez코인 잔액 (20만 코인)

            // 상품가격업데이트
            function updateProductPrice(productCard) {
                const basePrice = parseInt(productCard.data('price'));
                const quantity = parseInt(productCard.find('.quantity-input').val());
                const totalPrice = basePrice * quantity;
                productCard.find('.product-price').text(totalPrice.toLocaleString() + ' ez코인');
            }

            // 총가격업데이트
            function updateTotalPrice() {
                let totalPrice = 0;
                let itemCount = 0;
                $('.product-checkbox:checked').each(function () {
                    const productCard = $(this).closest('.product-card');
                    const quantity = parseInt(productCard.find('.quantity-input').val());
                    totalPrice += parseInt(productCard.data('price')) * quantity;
                    itemCount += quantity;
                });

                $('#item-count').text(itemCount);
                $('#total-amount').text(totalPrice.toLocaleString() + ' ez코인');

                const shippingCost = totalPrice >= 50000 ? 0 : 3000;
                $('#shipping-cost').text(shippingCost.toLocaleString() + ' ez코인');

                const finalAmount = totalPrice + shippingCost;
                $('#final-amount').text(finalAmount.toLocaleString() + ' ez코인');
            }

            // '전체 선택 해제' 버튼 표시/숨김
            function updateDeselectAllButton() {
                const anyChecked = $('.product-checkbox:checked').length > 0;
                if (anyChecked) {
                    $('#deselect-all').show();
                } else {
                    $('#deselect-all').hide();
                }
            }

            $('.product-checkbox').change(function() {
                // 체크박스 변경 시 총 가격 및 버튼 상태 업데이트
                updateTotalPrice();
                updateDeselectAllButton();
            });

            $('#select-all').click(function () {
                // 전체 선택 기능
                $('.product-checkbox').prop('checked', true);
                updateTotalPrice();
                updateDeselectAllButton();
            });

            $('#deselect-all').click(function () {
                // 전체 선택 해제 기능
                $('.product-checkbox').prop('checked', false);
                updateTotalPrice();
                updateDeselectAllButton();
            });

            $('.edit-btn').click(function () {
                // 옵션 변경 폼 표시
                const productCard = $(this).closest('.product-card');
                productCard.find('.edit-form').show();
                $(this).hide();
            });

            $('.save-btn').click(function () {
                // 변경된 옵션 저장 및 가격 업데이트
                const productCard = $(this).closest('.product-card');
                const newSize = productCard.find('.size-select').val();
                const newQuantity = productCard.find('.quantity-input').val();

                productCard.find('.product-info').text(`사이즈 : ${newSize} / 수량 : ${newQuantity}개`);

                updateProductPrice(productCard);
                updateTotalPrice();

                productCard.find('.edit-form').hide();
                productCard.find('.edit-btn').show();
            });

            $('.cancel-btn').click(function () {
                // 옵션 변경 취소
                const productCard = $(this).closest('.product-card');
                productCard.find('.edit-form').hide();
                productCard.find('.edit-btn').show();
            });

            $('#delete-selected').click(function () {
                // 선택된 상품 삭제
                $('.product-checkbox:checked').closest('.product-card').remove();
                updateTotalPrice();
                updateDeselectAllButton();
            });

            // 초기 가격 설정
            $('.product-card').each(function () {
                updateProductPrice($(this));
            });
            updateTotalPrice();


                    // 구매하기 버튼 클릭 시 결제 모달 표시
                    $('.btn-primary.btn-block').click(function () {
                        let selectedProducts = '';
                        let totalAmount = 0;

                        $('.product-checkbox:checked').each(function () {
                            const productCard = $(this).closest('.product-card');
                            const productName = productCard.find('.card-title').text();
                            const productInfo = productCard.find('.product-info').text();
                            const productPrice = productCard.find('.product-price').text();
                            const productImage = productCard.find('img').attr('src');

                            selectedProducts += `
                        <div class="col-12 mb-3">
                            <div class="card h-100">
                                <div class="row no-gutters">
                                    <div class="col-4">
                                        <img src="${productImage}" class="card-img" alt="${productName}">
                                    </div>
                                    <div class="col-8">
                                        <div class="card-body p-2">
                                            <h6 class="card-title mb-1">${productName}</h6>
                                            <p class="card-text mb-1"><small>${productInfo}</small></p>
                                            <p class="card-text"><small class="text-muted">${productPrice}</small></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;

                            totalAmount += parseInt(productPrice.replace(/[^0-9]/g, ''));
                        });

                        const shippingCost = totalAmount >= 50000 ? 0 : 3000;
                        const finalAmount = totalAmount + shippingCost;

                        const paymentSummary = `
                    <p>상품 총액: <strong>${totalAmount.toLocaleString()} EZ코인</strong></p>
                    <p>배송비: <strong>${shippingCost.toLocaleString()} EZ코인</strong></p>
                    <hr>
                    <p class="font-weight-bold">최종 결제 금액: <span class="text-primary">${finalAmount.toLocaleString()} EZ코인</span></p>
                    <p>보유 코인: <strong>${userBalance.toLocaleString()} EZ코인</strong></p>
                `;

                        $('#selected-products').html(selectedProducts);
                        $('#payment-summary').html(paymentSummary);

                        // 잔액 부족 여부 확인 및 표시
                        if (finalAmount > userBalance) {
                            $('#insufficient-funds').show();
                            $('#confirm-payment').prop('disabled', true);
                        } else {
                            $('#insufficient-funds').hide();
                            $('#confirm-payment').prop('disabled', false);
                        }

                        $('#paymentModal').modal('show');
                    });

                    // 결제 확인 버튼 클릭 시 동작
                    $('#confirm-payment').click(function () {
                        alert('결제가 완료되었습니다.');
                        $('#paymentModal').modal('hide');
                    });
                    // 충전 버튼 클릭 시 동작
                    $('#recharge-button').click(function () {
                        alert('마이페이지로 이동합니다.');
                        // 여기에 충전 페이지로 이동하는 로직을 추가할 수 있습니다.
                    });
                }); 
    </script>
</body>

</html>